<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nanopub Creator Demo</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      background: #f5f5f5;
    }

    .demo-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .demo-header {
      background: white;
      padding: 30px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .demo-header h1 {
      margin: 0 0 10px 0;
      color: #333;
    }

    .demo-header p {
      margin: 0;
      color: #666;
    }

    .demo-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    @media (min-width: 1024px) {
      .demo-content {
        grid-template-columns: 2fr 1fr;
      }
    }

    .demo-creator {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .demo-sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .demo-info {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .demo-info h3 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 18px;
    }

    .demo-output {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .demo-output h3 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 18px;
    }

    .output-content {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
    }

    .template-select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .event-log {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 11px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 10px;
    }

    .event-log-item {
      padding: 5px;
      border-bottom: 1px solid #e0e0e0;
    }

    .event-log-item:last-child {
      border-bottom: none;
    }

    .event-log-time {
      color: #666;
      margin-right: 10px;
    }

    .event-log-type {
      font-weight: 600;
      margin-right: 10px;
    }

    .event-log-type.change { color: #2196f3; }
    .event-log-type.submit { color: #4caf50; }
    .event-log-type.error { color: #f44336; }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="demo-header">
      <h1>ðŸ§¬ Nanopub Creator Demo</h1>
      <p>Create nanopublications from templates using the nanopub-create library</p>
    </div>

    <div class="demo-content">
      <div class="demo-creator" id="creator-container"></div>
      
      <div class="demo-sidebar">
        <div class="demo-info">
          <h3>ðŸ“‹ Template Selection</h3>
          <select class="template-select" id="template-select">
            <option value="https://w3id.org/np/RA24onqmqTMsraJ7ypYFOuckmNWpo4Zv5gsLqhXt7xYPU">
              Declare Citation with Comment
            </option>
            <option value="https://w3id.org/np/RAi3p74nRQdXBYWCzZnb9T0KqWNNj-kbp7j5N1ovZ1UqI">
              PICO Template
            </option>
            <option value="https://w3id.org/np/RAmk-gxK8aN6Jf6vcnxuJcNv3vMj-7iwRlZYmrLmPNNnI">
              Scholarly Work Metadata
            </option>
          </select>
          
          <h4>About This Demo</h4>
          <p style="font-size: 14px; color: #666;">
            This demo shows the nanopub-create library in action. Select a template above, 
            fill in the form, and click "Create Nanopublication" to see the generated TriG output.
          </p>
        </div>

        <div class="demo-output">
          <h3>ðŸ“¤ Output</h3>
          <div class="output-content" id="output-content">
            <em>Submit the form to see the generated nanopublication here...</em>
          </div>
        </div>

        <div class="demo-info">
          <h3>ðŸ”” Event Log</h3>
          <div class="event-log" id="event-log"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import NanopubCreator from '../src/index.js';
    import '../src/styles/creator.css';

    const container = document.getElementById('creator-container');
    const outputContent = document.getElementById('output-content');
    const eventLog = document.getElementById('event-log');
    const templateSelect = document.getElementById('template-select');

    let creator = null;

    function logEvent(type, message) {
      const timestamp = new Date().toLocaleTimeString();
      const logItem = document.createElement('div');
      logItem.className = 'event-log-item';
      logItem.innerHTML = `
        <span class="event-log-time">${timestamp}</span>
        <span class="event-log-type ${type}">${type.toUpperCase()}</span>
        ${message}
      `;
      eventLog.insertBefore(logItem, eventLog.firstChild);
      
      // Keep only last 20 items
      while (eventLog.children.length > 20) {
        eventLog.removeChild(eventLog.lastChild);
      }
    }

    async function loadTemplate(templateUri) {
      logEvent('change', `Loading template: ${templateUri}`);
      
      if (creator) {
        creator.destroy();
      }

      creator = new NanopubCreator({
        publishServer: 'https://np.petapico.org/',
        theme: 'default',
        validateOnChange: true,
        showHelp: true
      });

      creator.on('change', (data) => {
        logEvent('change', `Form updated: ${Object.keys(data).join(', ')}`);
      });

      creator.on('submit', async ({ trigContent, formData }) => {
        logEvent('submit', 'Form submitted successfully');
        outputContent.textContent = trigContent;
      });

      creator.on('error', ({ type, error, errors }) => {
        logEvent('error', `Error (${type}): ${error?.message || errors?.join(', ')}`);
      });

      try {
        await creator.renderFromTemplateUri(templateUri, container);
        logEvent('change', 'Template loaded and form rendered');
      } catch (error) {
        logEvent('error', `Failed to load template: ${error.message}`);
        container.innerHTML = `
          <div style="padding: 20px; background: #ffebee; border-radius: 4px; color: #c62828;">
            <strong>Error loading template:</strong><br>
            ${error.message}
          </div>
        `;
      }
    }

    // Load initial template
    loadTemplate(templateSelect.value);

    // Handle template changes
    templateSelect.addEventListener('change', (e) => {
      loadTemplate(e.target.value);
    });

    // Log initial event
    logEvent('change', 'Demo initialized');
  </script>
</body>
</html>
